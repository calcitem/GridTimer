# Android æ¡Œé¢å°éƒ¨ä»¶å®ç°æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

GridTimer ç°å·²æ”¯æŒ Android æ¡Œé¢å°éƒ¨ä»¶ï¼Œç”¨æˆ·å¯ä»¥å°†è®¡æ—¶å™¨çŠ¶æ€æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œæ— éœ€æ‰“å¼€åº”ç”¨å³å¯æŸ¥çœ‹ï¼š

- **æ´»è·ƒè®¡æ—¶å™¨æ•°é‡**ï¼šæ˜¾ç¤ºæ­£åœ¨è¿è¡Œæˆ–æš‚åœçš„è®¡æ—¶å™¨æ€»æ•°
- **å“é“ƒè®¡æ—¶å™¨æ•°é‡**ï¼šæ˜¾ç¤ºå½“å‰å“é“ƒçš„è®¡æ—¶å™¨æ•°é‡
- **æœ€è¿‘è®¡æ—¶å™¨ä¿¡æ¯**ï¼šæ˜¾ç¤ºæœ€å¿«å³å°†ç»“æŸçš„è®¡æ—¶å™¨åç§°å’Œå‰©ä½™æ—¶é—´
- **ä¸€é”®æ‰“å¼€åº”ç”¨**ï¼šç‚¹å‡»å°éƒ¨ä»¶å¯ç›´æ¥æ‰“å¼€ GridTimer åº”ç”¨
- **æ‰‹åŠ¨åˆ·æ–°**ï¼šæä¾›åˆ·æ–°æŒ‰é’®å¯æ‰‹åŠ¨æ›´æ–°å°éƒ¨ä»¶çŠ¶æ€

## æŠ€æœ¯å®ç°

### 1. ä¾èµ–é¡¹

åœ¨ `pubspec.yaml` ä¸­æ·»åŠ ï¼š
```yaml
home_widget: ^0.7.0
```

### 2. Android åŸç”Ÿä»£ç 

#### æ–‡ä»¶ç»“æ„
```
android/app/src/main/
â”œâ”€â”€ kotlin/com/gridtimer/app/
â”‚   â””â”€â”€ GridTimerWidgetProvider.kt    # Widget æä¾›è€…
â”œâ”€â”€ res/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â””â”€â”€ widget_grid_timer.xml     # Widget å¸ƒå±€
â”‚   â”œâ”€â”€ drawable/
â”‚   â”‚   â””â”€â”€ widget_background.xml     # Widget èƒŒæ™¯æ ·å¼
â”‚   â”œâ”€â”€ xml/
â”‚   â”‚   â””â”€â”€ widget_info.xml           # Widget å…ƒæ•°æ®
â”‚   â””â”€â”€ values/
â”‚       â””â”€â”€ strings.xml               # å­—ç¬¦ä¸²èµ„æº
â””â”€â”€ AndroidManifest.xml               # æ³¨å†Œ Widget
```

#### GridTimerWidgetProvider.kt
- ç»§æ‰¿è‡ª `AppWidgetProvider`
- è´Ÿè´£è¯»å– Flutter ä¼ é€’çš„æ•°æ®å¹¶æ›´æ–° UI
- å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼ˆæ‰“å¼€åº”ç”¨ã€åˆ·æ–°ï¼‰

#### widget_grid_timer.xml
- ä½¿ç”¨ `RemoteViews` å…¼å®¹çš„å¸ƒå±€
- åŒ…å«æ ‡é¢˜ã€çŠ¶æ€ã€è®¡æ—¶å™¨ä¿¡æ¯ã€åˆ·æ–°æŒ‰é’®
- é‡‡ç”¨åœ†è§’å¡ç‰‡è®¾è®¡ï¼Œé€‚é…é•¿è¾ˆä½¿ç”¨ä¹ æƒ¯

#### widget_info.xml
- å®šä¹‰å°éƒ¨ä»¶å°ºå¯¸ï¼šæœ€å° 180dp Ã— 110dp
- ç›®æ ‡ç½‘æ ¼å¤§å°ï¼š3Ã—2
- æ”¯æŒæ°´å¹³å’Œå‚ç›´è°ƒæ•´å¤§å°
- æ›´æ–°å‘¨æœŸï¼šæŒ‰éœ€æ›´æ–°ï¼ˆ0msï¼‰

### 3. Flutter ä»£ç 

#### WidgetService (lib/infrastructure/widget_service.dart)
æ ¸å¿ƒæœåŠ¡ç±»ï¼Œè´Ÿè´£ï¼š
- åˆå§‹åŒ–å°éƒ¨ä»¶æœåŠ¡
- ç»Ÿè®¡è®¡æ—¶å™¨çŠ¶æ€ï¼ˆæ´»è·ƒã€å“é“ƒã€æœ€è¿‘ï¼‰
- æ ¼å¼åŒ–æ˜¾ç¤ºæ•°æ®
- é€šè¿‡ `home_widget` æ’ä»¶æ›´æ–°å°éƒ¨ä»¶

ä¸»è¦æ–¹æ³•ï¼š
```dart
// åˆå§‹åŒ–
Future<void> init()

// æ›´æ–°å°éƒ¨ä»¶ï¼ˆä¼ å…¥æ‰€æœ‰è®¡æ—¶å™¨ä¼šè¯ï¼‰
Future<void> updateWidget(List<TimerSession> sessions)
```

#### é›†æˆåˆ°ä¸»åº”ç”¨
1. åœ¨ `lib/app/providers.dart` ä¸­æ³¨å†Œ `widgetServiceProvider`
2. åœ¨ `lib/main.dart` ä¸­ï¼š
   - åˆå§‹åŒ– WidgetService
   - ç›‘å¬ `gridStateProvider` çŠ¶æ€å˜åŒ–
   - è‡ªåŠ¨è°ƒç”¨ `updateWidget()` æ›´æ–°å°éƒ¨ä»¶

### 4. è‡ªåŠ¨æ›´æ–°æœºåˆ¶

```dart
// åœ¨ main.dart çš„ _setupWidgetUpdates() ä¸­
ref.listen(gridStateProvider, (previous, next) {
  next.whenData((state) {
    final (_, sessions) = state;
    ref.read(widgetServiceProvider).updateWidget(sessions);
  });
});
```

æ¯å½“è®¡æ—¶å™¨çŠ¶æ€å˜åŒ–æ—¶ï¼ˆå¯åŠ¨ã€æš‚åœã€åœæ­¢ã€å“é“ƒï¼‰ï¼Œå°éƒ¨ä»¶ä¼šè‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºã€‚

## ä½¿ç”¨æŒ‡å—

### æ·»åŠ å°éƒ¨ä»¶åˆ°ä¸»å±å¹•

1. é•¿æŒ‰ Android ä¸»å±å¹•ç©ºç™½åŒºåŸŸ
2. é€‰æ‹©"å°éƒ¨ä»¶"æˆ–"Widgets"
3. æ‰¾åˆ°"GridTimer"å°éƒ¨ä»¶
4. æ‹–åŠ¨åˆ°ä¸»å±å¹•åˆé€‚ä½ç½®
5. è°ƒæ•´å¤§å°ï¼ˆå¯é€‰ï¼‰

### å°éƒ¨ä»¶äº¤äº’

- **ç‚¹å‡»å°éƒ¨ä»¶ä¸»ä½“**ï¼šæ‰“å¼€ GridTimer åº”ç”¨
- **ç‚¹å‡»åˆ·æ–°æŒ‰é’®**ï¼ˆå³ä¸Šè§’ï¼‰ï¼šæ‰‹åŠ¨åˆ·æ–°å°éƒ¨ä»¶çŠ¶æ€

### æ˜¾ç¤ºå†…å®¹è¯´æ˜

| çŠ¶æ€ | æ˜¾ç¤ºå†…å®¹ |
|------|----------|
| æœ‰è®¡æ—¶å™¨å“é“ƒ | ğŸ”” N ä¸ªè®¡æ—¶å™¨å“é“ƒ |
| æœ‰è®¡æ—¶å™¨è¿è¡Œ | â±ï¸ N ä¸ªè®¡æ—¶å™¨è¿è¡Œä¸­<br>Timer X: MM:SSï¼ˆæœ€è¿‘çš„ï¼‰ |
| æ— æ´»è·ƒè®¡æ—¶å™¨ | ğŸ“± ç‚¹å‡»æ‰“å¼€åº”ç”¨ |

## æ³¨æ„äº‹é¡¹

1. **å¹³å°é™åˆ¶**ï¼šæ­¤åŠŸèƒ½ä»…é€‚ç”¨äº Android å¹³å°
2. **æ›´æ–°é¢‘ç‡**ï¼šå°éƒ¨ä»¶ä¼šåœ¨è®¡æ—¶å™¨çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ï¼Œä½†ç”±äº Android ç³»ç»Ÿé™åˆ¶ï¼Œæ˜¾ç¤ºå¯èƒ½æœ‰è½»å¾®å»¶è¿Ÿ
3. **ç”µæ± ä¼˜åŒ–**ï¼šå°éƒ¨ä»¶æ›´æ–°ä¸ä¼šæŒç»­æ¶ˆè€—ç”µé‡ï¼Œä»…åœ¨å¿…è¦æ—¶æ›´æ–°
4. **æƒé™è¦æ±‚**ï¼šæ— éœ€é¢å¤–æƒé™å³å¯ä½¿ç”¨å°éƒ¨ä»¶

## å¼€å‘è¯´æ˜

### æµ‹è¯•å°éƒ¨ä»¶

1. è¿è¡Œ `flutter pub get` è·å–ä¾èµ–
2. æ„å»ºå¹¶å®‰è£…åº”ç”¨ï¼š`flutter run` æˆ– `flutter build apk`
3. åœ¨ä¸»å±å¹•æ·»åŠ å°éƒ¨ä»¶
4. å¯åŠ¨/åœæ­¢è®¡æ—¶å™¨ï¼Œè§‚å¯Ÿå°éƒ¨ä»¶æ›´æ–°

### è°ƒè¯•

æŸ¥çœ‹ logcat æ—¥å¿—ï¼š
```bash
adb logcat | grep -i "WidgetService\|GridTimerWidget"
```

### è‡ªå®šä¹‰å°éƒ¨ä»¶æ ·å¼

ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š
- `android/app/src/main/res/layout/widget_grid_timer.xml` - å¸ƒå±€
- `android/app/src/main/res/drawable/widget_background.xml` - èƒŒæ™¯æ ·å¼

## æœªæ¥æ”¹è¿›æ–¹å‘

- [ ] æ·»åŠ å°éƒ¨ä»¶é…ç½®é¡µé¢ï¼ˆé€‰æ‹©æ˜¾ç¤ºå“ªäº›è®¡æ—¶å™¨ï¼‰
- [ ] æ”¯æŒä»å°éƒ¨ä»¶ç›´æ¥æ§åˆ¶è®¡æ—¶å™¨ï¼ˆå¯åŠ¨/æš‚åœ/åœæ­¢ï¼‰
- [ ] æä¾›å¤šç§å°éƒ¨ä»¶å°ºå¯¸ï¼ˆ1Ã—1ã€2Ã—2ã€4Ã—2 ç­‰ï¼‰
- [ ] æ·»åŠ æ·±è‰²ä¸»é¢˜æ”¯æŒ
- [ ] æ˜¾ç¤ºå¤šä¸ªæ´»è·ƒè®¡æ—¶å™¨çš„åˆ—è¡¨

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `lib/infrastructure/widget_service.dart`
- `android/app/src/main/kotlin/com/gridtimer/app/GridTimerWidgetProvider.kt`
- `android/app/src/main/res/layout/widget_grid_timer.xml`
- `android/app/src/main/res/drawable/widget_background.xml`
- `android/app/src/main/res/xml/widget_info.xml`
- `android/app/src/main/res/values/strings.xml`

### ä¿®æ”¹æ–‡ä»¶
- `pubspec.yaml` - æ·»åŠ  home_widget ä¾èµ–
- `lib/app/providers.dart` - æ·»åŠ  widgetServiceProvider
- `lib/main.dart` - åˆå§‹åŒ–å¹¶é›†æˆå°éƒ¨ä»¶æ›´æ–°é€»è¾‘
- `android/app/src/main/AndroidManifest.xml` - æ³¨å†Œ Widget

---

**å®ç°æ—¥æœŸ**ï¼š2025-12-31
**ç‰ˆæœ¬**ï¼š1.0.0

